# Routers Context

이 폴더는 모든 API 엔드포인트를 정의하는 라우터 모듈을 포함합니다.

## 라우터 목록

| 파일 | Prefix | 설명 |
|------|--------|------|
| auth.py | `/api/auth` | 카카오 로그인, 내 정보 조회 |
| users.py | `/api/users` | 유저 목록, 프로필 수정, 역할 변경 |
| sessions.py | `/api/sessions` | 세션(악기) CRUD, 유저 세션 관리 |
| reservations.py | `/api/reservations` | 예약 CRUD, 참여/취소 |
| teams.py | `/api/teams` | 팀 CRUD, 멤버 추가/삭제 |
| notices.py | `/api/notices` | 공지사항 CRUD |

## 공통 패턴

- 모든 보호된 엔드포인트는 `Depends(get_current_user)`로 인증
- admin/root 전용 엔드포인트는 핸들러 내부에서 `current_user.role` 검사
- DB 세션은 `Depends(get_db)`로 주입
- 응답은 `schemas/` 폴더의 Pydantic 모델로 직렬화

---

## Auth (`/api/auth`)

### Purpose & Logic
카카오 OAuth2 인증을 통해 유저를 식별하고 JWT를 발급한다. 첫 로그인 시 유저를 자동 생성한다.

### Endpoints
| Method | Path | Auth | 설명 |
|--------|------|------|------|
| POST | `/kakao/login` | - | 인가코드로 로그인, JWT 반환 |
| GET | `/kakao/callback` | - | 브라우저 리다이렉트용 콜백 |
| GET | `/me` | JWT | 현재 로그인 유저 정보 |

### Connectivity
- **Services:** `services/kakao.py` (카카오 API), `services/jwt.py` (토큰 생성)
- **Schemas:** `KakaoLoginRequest`, `TokenResponse`, `UserResponse`
- **DB Tables:** `users`

### Key Files
- `routers/auth.py` — 엔드포인트 정의
- `services/kakao.py` — 카카오 토큰 교환 및 유저 정보 조회
- `services/jwt.py` — JWT 생성/검증

---

## Users (`/api/users`)

### Purpose & Logic
유저 목록 조회, 프로필 수정, 역할(권한) 변경을 처리한다. 역할 변경은 root만 가능.

### Endpoints
| Method | Path | Auth | 설명 |
|--------|------|------|------|
| GET | `/` | JWT | 전체 유저 목록 (nickname 정렬) |
| PUT | `/me` | JWT | 내 프로필 수정 (nickname, affiliation) |
| PUT | `/{user_id}/role` | JWT (root) | 유저 역할 변경 |

### Connectivity
- **Schemas:** `UserProfileUpdate`, `UserRoleUpdate`, `UserListResponse`, `UserResponse`
- **DB Tables:** `users`

### Key Files
- `routers/users.py` — 엔드포인트 정의
- `models/user.py` — User 모델

---

## Sessions (`/api/sessions`)

### Purpose & Logic
세션(악기/파트)을 관리한다. 전역 세션은 admin이 생성하고, 각 유저는 자신의 악기와 숙련도를 등록한다.

### Endpoints
| Method | Path | Auth | 설명 |
|--------|------|------|------|
| GET | `/` | JWT | 전체 세션 목록 |
| POST | `/` | JWT (admin/root) | 세션 생성 |
| GET | `/me` | JWT | 내 세션 목록 |
| POST | `/me` | JWT | 내 세션 추가 |
| PUT | `/me/{user_session_id}` | JWT | 내 세션 수정 |
| DELETE | `/me/{user_session_id}` | JWT | 내 세션 삭제 |

### Connectivity
- **Schemas:** `SessionCreate`, `SessionResponse`, `UserSessionCreate`, `UserSessionUpdate`, `UserSessionResponse`
- **DB Tables:** `sessions`, `user_sessions`

### Key Files
- `routers/sessions.py` — 엔드포인트 정의
- `models/session.py` — Session, UserSession 모델

---

## Reservations (`/api/reservations`)

### Purpose & Logic
합주 예약을 생성하고 멤버가 참여/취소할 수 있다. 월별 캘린더 뷰를 제공한다.

### Endpoints
| Method | Path | Auth | 설명 |
|--------|------|------|------|
| GET | `/?year=&month=` | JWT | 월별 예약 목록 (참여자 수 포함) |
| POST | `/` | JWT | 예약 생성 |
| GET | `/{id}` | JWT | 예약 상세 (참여자 목록 포함) |
| PUT | `/{id}` | JWT (creator/admin/root) | 예약 수정 |
| DELETE | `/{id}` | JWT (creator/admin/root) | 예약 삭제 |
| POST | `/{id}/participate` | JWT | 예약 참여 |
| DELETE | `/{id}/participate` | JWT | 참여 취소 |

### Connectivity
- **Schemas:** `ReservationCreate`, `ReservationUpdate`, `ReservationResponse`, `ReservationDetailResponse`, `ParticipantResponse`
- **DB Tables:** `reservations`, `reservation_participants`, `users`

### Key Files
- `routers/reservations.py` — 엔드포인트 정의
- `models/reservation.py` — Reservation, ReservationParticipant 모델

---

## Teams (`/api/teams`)

### Purpose & Logic
팀(밴드)을 관리하고 멤버를 배정한다. 각 멤버는 팀 내에서 담당 세션(악기)이 지정된다.

### Endpoints
| Method | Path | Auth | 설명 |
|--------|------|------|------|
| GET | `/` | JWT | 팀 목록 (멤버 수 포함) |
| POST | `/` | JWT (admin/root) | 팀 생성 |
| GET | `/{id}` | JWT | 팀 상세 (멤버 목록 포함) |
| PUT | `/{id}` | JWT (admin/root) | 팀 수정 |
| POST | `/{id}/members` | JWT (admin/root) | 멤버 추가 |
| DELETE | `/{id}/members/{user_id}` | JWT (admin/root) | 멤버 삭제 |

### Connectivity
- **Schemas:** `TeamCreate`, `TeamUpdate`, `TeamResponse`, `TeamDetailResponse`, `AddTeamMember`, `TeamMemberResponse`
- **DB Tables:** `teams`, `team_members`, `users`, `sessions`

### Key Files
- `routers/teams.py` — 엔드포인트 정의
- `models/team.py` — Team, TeamMember 모델

---

## Notices (`/api/notices`)

### Purpose & Logic
운영진이 공지사항을 작성하고 멤버들이 조회한다. 페이지네이션을 지원한다.

### Endpoints
| Method | Path | Auth | 설명 |
|--------|------|------|------|
| GET | `/?page=&size=` | JWT | 공지 목록 (최신순, 페이지네이션) |
| POST | `/` | JWT (admin/root) | 공지 작성 |
| GET | `/{id}` | JWT | 공지 상세 |
| PUT | `/{id}` | JWT (admin/root) | 공지 수정 |
| DELETE | `/{id}` | JWT (admin/root) | 공지 삭제 |

### Connectivity
- **Schemas:** `NoticeCreate`, `NoticeUpdate`, `NoticeResponse`
- **DB Tables:** `notices`, `users` (author)

### Key Files
- `routers/notices.py` — 엔드포인트 정의
- `models/notice.py` — Notice 모델
